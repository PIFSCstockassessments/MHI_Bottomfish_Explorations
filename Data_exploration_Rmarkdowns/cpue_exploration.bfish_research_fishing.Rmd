<!-- # Nicholas Ducharme-Barth
# 03/15/2022
# CPUE data exploration for BFISH research fishing data
# Copyright (c) 2022 Nicholas Ducharme-Barth
# You should have received a copy of the GNU General Public License along with this program.  If not, see <https://www.gnu.org/licenses/>.
setwd("D:/HOME/SAP/Code/MHI_Bottomfish_2023/Data_exploration_Rmarkdowns/")
rmarkdown::find_pandoc(dir="D:/HOME/AppData/Local/Pandoc")
rmarkdown::render("cpue_exploration.bfish_research_fishing.Rmd")
 -->
---
title: "CPUE Data Exploration - BFISH Research Fishing"
author: "Nicholas Ducharme-Barth"
date: "03/15/2022"
output: 
  html_document:
    toc: yes
    toc_float: true
---


```{r setup, include=FALSE}

	#_____________________________________________________________________________________________________________________________
	# load packages
		knitr::opts_chunk$set(echo = FALSE, message = FALSE)
		library(data.table)
		library(magrittr)
		library(ggplot2)
		library(ggthemes)
		library(nmfspalette)
	#_____________________________________________________________________________________________________________________________
	# set working directory
		proj.dir = "D:/HOME/SAP/2024_Deep7/"
		setwd(proj.dir)
		source("D:/HOME/SAP/Code/Utilities/turbo.r")

		# plot_dir = "D:/HOME/SAP/Code/MHI_Bottomfish_2023/Data_exploration_Rmarkdowns/BFISH_CPUE/")
		# dir.create(plot_dir,recursive=TRUE,showWarnings=FALSE)

	#_____________________________________________________________________________________________________________________________
	# bring in data
		load(paste0(proj.dir,"Data/research_fishing_dt.RData"))
		deep8_code_vec = c("ETCA","APRU","PRSI","HYQU","PRFI","PRZO","ETCO","APVI")
		deep8_name_vec = c("Ehu", "Lehi", "Kalekale", "Hapuupuu", "Opakapaka", "Gindai", "Onaga", "Uku")
```
Research fishing makes up one of the two survey sampling gears used in the Bottomfish Fishery independent Survey in the Main Hawaiian Islands (BFISH). A standard research fishing sample was conducted at each primary sampling unit (PSU) that was allocated to the research fishing gear as a part of the stratified random sampling design process. A standard research fishing sample consisted of 30 minutes of active hook and line fishing within the PSU by one vessel using two lines. Each line was fished with four hooks and two bait types, squid and fish. More information on how this data is incorporated into the stock assessment can be found [here](https://www.fisheries.noaa.gov/species/main-hawaiian-islands-deep-7-bottomfish#overview).

This document visualizes patterns in species specific catch for research fishing conducted as a part of BFISH sampling.

## Catch comparison between paired baits within sample

```{r warning=FALSE}
	cols = c("SAMPLE_ID","BAIT_CD",deep8_code_vec)
	research_fishing_dt %>%
	.[,cols,with=FALSE] %>%
	melt(.,id.vars=c("SAMPLE_ID","BAIT_CD")) %>%
	.[,value:=value+0.25] %>%
	dcast(.,SAMPLE_ID+variable~BAIT_CD) %>%
	setnames(.,c("F","S"),c("Fish","Squid")) %>%
	.[,variable:=factor(variable,levels=deep8_code_vec,labels=deep8_name_vec)] %>%
	ggplot() +
	xlab("Catch (Fish bait)") + ylab("Catch (Squid bait)") +
	geom_abline(slope=1, intercept=0,color="gray70") +
    geom_jitter(aes(x = Fish, y=Squid, fill = variable),shape=21,color="black",size=1.25,width = 0.25,height=0.25) +
    geom_smooth(aes(x = Fish, y=Squid),method='lm', formula=y~0+x,color="black") +
    geom_hline(yintercept = 0) +
    theme_classic(base_size = 10) +
    facet_wrap(~ variable, scales = "free") +
    scale_fill_nmfs(name="Species",palette="regional web") +
    labs(title = "Sample catch by species.",
         caption = "Relationship between catch on fish baited hooks vs. squid baited hooks from the same sample. \n A linear regression between the paired catch across baits is shown in black.\n The 1:1 line is shown in gray.\n Points were jittered +/- 0.25 for visibility.")
```
```{r warning=FALSE}
	cols = c("SAMPLE_ID","BAIT_CD","Island",deep8_code_vec)
	research_fishing_dt %>%
	.[,cols,with=FALSE] %>%
	melt(.,id.vars=c("SAMPLE_ID","BAIT_CD","Island")) %>%
	.[,value:=value+0.25] %>%
	dcast(.,SAMPLE_ID+Island+variable~BAIT_CD) %>%
	setnames(.,c("F","S"),c("Fish","Squid")) %>%
	.[,variable:=factor(variable,levels=deep8_code_vec,labels=deep8_name_vec)] %>%
	.[,Island:=factor(Island,levels=c("Niihau","Kauai","Oahu","Maui Nui","Big Island"),labels=c("Niihau","Kauai","Oahu","Maui Nui","Hawaii"))] %>%
	ggplot() + 
	xlab("Catch (Fish bait)") + ylab("Catch (Squid bait)") +
	geom_abline(slope=1, intercept=0,color="gray70") +
    geom_jitter(aes(x = Fish, y=Squid, fill = variable),shape=21,color="black",size=1.25,width = 0.25,height=0.25) +
    geom_smooth(aes(x = Fish, y=Squid),method='lm', formula=y~0+x,color="black") +
    geom_hline(yintercept = 0) +
    theme_classic(base_size = 10) +
    facet_grid(variable ~ Island, scales = "free") +
    scale_fill_nmfs(name="Species",palette="regional web") +
    labs(title = "Sample catch by species and island group.",
         caption = "Relationship between catch on fish baited hooks vs. squid baited hooks from the same sample. \n A linear regression between the paired catch across baits is shown in black.\n The 1:1 line is shown in gray.\n Points were jittered +/- 0.25 for visibility.")
```

## Encounter probability

```{r warning=FALSE}
	cols = c("YEAR","Island",deep8_code_vec)
	research_fishing_dt %>%
	.[,cols,with=FALSE] %>%
	melt(.,id.vars=c("YEAR","Island")) %>%
	.[,value:=ifelse(value>0,1,0)] %>%
	.[,.(value=mean(value)),by=.(YEAR,variable)] %>%
	.[,value:=value*100] %>%
	.[,YEAR:=as.numeric(YEAR)] %>%
	.[,variable:=factor(variable,levels=deep8_code_vec,labels=deep8_name_vec)] %>%
	ggplot() +
	xlab("Year") + ylab("Encounter probability (%)") +
    geom_path(aes(x = YEAR, y=value, color = variable),size=1.25) +
    geom_hline(yintercept = 0) +
    theme_classic(base_size = 10) +
    facet_wrap(~ variable, scales = "free") +
    scale_color_nmfs(name="Species",palette="regional web") +
    labs(title = "Encounter probability by species.",
         caption = "The percent of research fishing sets that encountered each species. \n Note: Catch is recorded seperately by bait type within the same sample.")
```

```{r warning=FALSE}
	cols = c("YEAR","Island",deep8_code_vec)
	research_fishing_dt %>%
	.[,cols,with=FALSE] %>%
	melt(.,id.vars=c("YEAR","Island")) %>%
	.[,value:=ifelse(value>0,1,0)] %>%
	.[,.(value=mean(value)),by=.(YEAR,Island,variable)] %>%
	.[,value:=value*100] %>%
	.[,YEAR:=as.numeric(YEAR)] %>%
	.[,variable:=factor(variable,levels=deep8_code_vec,labels=deep8_name_vec)] %>%
	.[,Island:=factor(Island,levels=c("Niihau","Kauai","Oahu","Maui Nui","Big Island"),labels=c("Niihau","Kauai","Oahu","Maui Nui","Hawaii"))] %>%
	ggplot() +
	xlab("Year") + ylab("Encounter probability (%)") +
	scale_x_continuous(breaks=c(2017,2019)) +
    geom_path(aes(x = YEAR, y=value, color = variable),size=1.25) +
    geom_hline(yintercept = 0) +
    theme_classic(base_size = 10) +
    facet_grid(variable~Island, scales = "free") +
    scale_color_nmfs(name="Species",palette="regional web") +
    labs(title = "Encounter probability by species and island group.",
         caption = "The percent of research fishing sets that encountered each species. \n Note: Catch is recorded seperately by bait type within the same sample.")
```

```{r warning=FALSE}
	cols = c("YEAR","BAIT_CD",deep8_code_vec)
	research_fishing_dt %>%
	.[,cols,with=FALSE] %>%
	melt(.,id.vars=c("YEAR","BAIT_CD")) %>%
	.[,value:=ifelse(value>0,1,0)] %>%
	.[,.(value=mean(value)),by=.(YEAR,BAIT_CD,variable)] %>%
	.[,value:=value*100] %>%
	.[,YEAR:=as.numeric(YEAR)] %>%
	.[,variable:=factor(variable,levels=deep8_code_vec,labels=deep8_name_vec)] %>%
	.[,BAIT_CD:=factor(BAIT_CD,levels=c("F","S"),labels=c("Fish","Squid"))] %>%
	ggplot() +
	xlab("Year") + ylab("Encounter probability (%)") +
	scale_x_continuous(breaks=c(2017,2019)) +
    geom_path(aes(x = YEAR, y=value, color = BAIT_CD),size=1.25) +
    geom_hline(yintercept = 0) +
    theme_classic(base_size = 10) +
    facet_wrap(~variable, scales = "free") +
    scale_color_nmfs(name="Bait type",palette="regional web") +
    labs(title = "Encounter probability by species and bait type.",
         caption = "The percent of research fishing sets that encountered each species.")
```

```{r warning=FALSE}
	cols = c("YEAR","BAIT_CD","Island",deep8_code_vec)
	research_fishing_dt %>%
	.[,cols,with=FALSE] %>%
	melt(.,id.vars=c("YEAR","BAIT_CD","Island")) %>%
	.[,value:=ifelse(value>0,1,0)] %>%
	.[,.(value=mean(value)),by=.(YEAR,BAIT_CD,Island,variable)] %>%
	.[,value:=value*100] %>%
	.[,YEAR:=as.numeric(YEAR)] %>%
	.[,variable:=factor(variable,levels=deep8_code_vec,labels=deep8_name_vec)] %>%
	.[,BAIT_CD:=factor(BAIT_CD,levels=c("F","S"),labels=c("Fish","Squid"))] %>%
	.[,Island:=factor(Island,levels=c("Niihau","Kauai","Oahu","Maui Nui","Big Island"),labels=c("Niihau","Kauai","Oahu","Maui Nui","Hawaii"))] %>%
	ggplot() +
	xlab("Year") + ylab("Encounter probability (%)") +
	scale_x_continuous(breaks=c(2017,2019)) +
    geom_path(aes(x = YEAR, y=value, color = BAIT_CD),size=1.25) +
    geom_hline(yintercept = 0) +
    theme_classic(base_size = 10) +
    facet_grid(variable~Island, scales = "free") +
    scale_color_nmfs(name="Bait type",palette="regional web") +
    labs(title = "Encounter probability by species, bait type and island group.",
         caption = "The percent of research fishing sets that encountered each species.")
```

```{r warning=FALSE}
	cols = c("JD","MONTH",deep8_code_vec)
	research_fishing_dt %>%
	.[,cols,with=FALSE] %>%
	melt(.,id.vars=c("JD","MONTH")) %>%
	.[,value:=ifelse(value>0,1,0)] %>%
	.[,.(value=mean(value)),by=.(JD,MONTH,variable)] %>%
	.[,value:=value*100] %>%
	.[,JD:=as.numeric(JD)] %>%
	.[,MONTH:=as.numeric(MONTH)] %>%
	.[,variable:=factor(variable,levels=deep8_code_vec,labels=deep8_name_vec)] %>%
	.[,MONTH:=factor(as.character(MONTH),levels=as.character(1:12),labels=c("Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"))] %>%
	ggplot() +
	xlab("Month") + ylab("Encounter probability (%)") +
	scale_x_discrete(breaks=c("Feb","May","Aug","Nov"),drop=FALSE) +
    geom_boxplot(aes(x = MONTH, y=value, fill = variable),shape=21,color="black") +
    geom_hline(yintercept = 0) +
    theme_classic(base_size = 10) +
    facet_wrap(~variable, scales = "free") +
    scale_fill_nmfs(name="Species",palette="regional web") +
    labs(title = "Encounter probability by species and month.",
         caption = "The percent of research fishing sets that encountered each species. \n Note: Catch is recorded seperately by bait type within the same sample.")
```


```{r warning=FALSE}
	cols = c("JD","MONTH","Island",deep8_code_vec)
	research_fishing_dt %>%
	.[,cols,with=FALSE] %>%
	melt(.,id.vars=c("JD","MONTH","Island")) %>%
	.[,value:=ifelse(value>0,1,0)] %>%
	.[,.(value=mean(value)),by=.(JD,MONTH,Island,variable)] %>%
	.[,value:=value*100] %>%
	.[,JD:=as.numeric(JD)] %>%
	.[,MONTH:=as.numeric(MONTH)] %>%
	.[,variable:=factor(variable,levels=deep8_code_vec,labels=deep8_name_vec)] %>%
	.[,MONTH:=factor(as.character(MONTH),levels=as.character(1:12),labels=c("Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"))] %>%
	.[,Island:=factor(Island,levels=c("Niihau","Kauai","Oahu","Maui Nui","Big Island"),labels=c("Niihau","Kauai","Oahu","Maui Nui","Hawaii"))] %>%
	ggplot() +
	xlab("Month") + ylab("Encounter probability (%)") +
	scale_x_discrete(breaks=c("Feb","May","Aug","Nov"),drop=FALSE) +
    geom_boxplot(aes(x = MONTH, y=value, fill = variable),shape=21,color="black") +
    geom_hline(yintercept = 0) +
    theme_classic(base_size = 10) +
    facet_grid(variable~Island, scales = "free") +
    scale_fill_nmfs(name="Species",palette="regional web") +
    labs(title = "Encounter probability by species, month and island group.",
         caption = "The percent of research fishing sets that encountered each species. \n Note: Catch is recorded seperately by bait type within the same sample.")
```
```{r warning=FALSE}
	cols = c("LUNAR_PHASE",deep8_code_vec)
	research_fishing_dt %>%
	.[,cols,with=FALSE] %>%
	.[,LUNAR_PHASE_BIN:=floor(LUNAR_PHASE/0.125)*0.125] %>%
	melt(.,id.vars=c("LUNAR_PHASE_BIN","LUNAR_PHASE")) %>%
	.[,value:=ifelse(value>0,1,0)] %>%
	.[,.(value=mean(value)),by=.(LUNAR_PHASE_BIN,LUNAR_PHASE,variable)] %>%
	.[,value:=value*100] %>%
	.[,LUNAR_PHASE_BIN:=factor(as.character(LUNAR_PHASE_BIN),levels=as.character(seq(from=0,by=0.125,to=1)))] %>%
	.[,variable:=factor(variable,levels=deep8_code_vec,labels=deep8_name_vec)] %>%
	ggplot() +
	xlab("Lunar illumination") + ylab("Encounter probability (%)") +
	scale_x_discrete(breaks=as.character(c(0,0.25,0.5,0.75,1)),drop=FALSE) +
    geom_boxplot(aes(x = LUNAR_PHASE_BIN, y=value, fill = variable),shape=21,color="black") +
    geom_hline(yintercept = 0) +
    theme_classic(base_size = 10) +
    facet_wrap(~variable, scales = "free") +
    scale_fill_nmfs(name="Species",palette="regional web") +
    labs(title = "Encounter probability by species and degree of lunar illumination.",
         caption = "The percent of research fishing sets that encountered each species. \n Note: Catch is recorded seperately by bait type within the same sample.")
```
```{r warning=FALSE}
	cols = c("LUNAR_PHASE","Island",deep8_code_vec)
	research_fishing_dt %>%
	.[,cols,with=FALSE] %>%
	.[,LUNAR_PHASE_BIN:=floor(LUNAR_PHASE/0.125)*0.125] %>%
	melt(.,id.vars=c("Island","LUNAR_PHASE_BIN","LUNAR_PHASE")) %>%
	.[,value:=ifelse(value>0,1,0)] %>%
	.[,.(value=mean(value)),by=.(Island,LUNAR_PHASE_BIN,LUNAR_PHASE,variable)] %>%
	.[,value:=value*100] %>%
	.[,LUNAR_PHASE_BIN:=factor(as.character(LUNAR_PHASE_BIN),levels=as.character(seq(from=0,by=0.125,to=1)))] %>%
	.[,variable:=factor(variable,levels=deep8_code_vec,labels=deep8_name_vec)] %>%
	.[,Island:=factor(Island,levels=c("Niihau","Kauai","Oahu","Maui Nui","Big Island"),labels=c("Niihau","Kauai","Oahu","Maui Nui","Hawaii"))] %>%
	ggplot() +
	xlab("Lunar illumination") + ylab("Encounter probability (%)") +
	scale_x_discrete(breaks=as.character(c(0,0.25,0.5,0.75,1)),drop=FALSE) +
    geom_boxplot(aes(x = LUNAR_PHASE_BIN, y=value, fill = variable),shape=21,color="black") +
    geom_hline(yintercept = 0) +
    theme_classic(base_size = 10) +
    facet_grid(variable~Island, scales = "free") +
    scale_fill_nmfs(name="Species",palette="regional web") +
    labs(title = "Encounter probability by species, degree of lunar illumination, and island group.",
         caption = "The percent of research fishing sets that encountered each species. \n Note: Catch is recorded seperately by bait type within the same sample.")
```

```{r warning=FALSE}
	cols = c("LUNAR_PHASE","JD","MONTH",deep8_code_vec)
	research_fishing_dt %>%
	.[,cols,with=FALSE] %>%
	.[,LUNAR_PHASE_BIN:=floor(LUNAR_PHASE/0.125)*0.125] %>%
	melt(.,id.vars=c("MONTH","JD","LUNAR_PHASE_BIN","LUNAR_PHASE")) %>%
	.[,value:=ifelse(value>0,1,0)] %>%
	.[,.(value=mean(value),.N),by=.(MONTH,LUNAR_PHASE_BIN,variable)] %>%
	.[,value:=value*100] %>%
	.[,variable:=factor(variable,levels=deep8_code_vec,labels=deep8_name_vec)] %>%
	.[,MONTH:=as.numeric(MONTH)] %>%
	.[,MONTH:=factor(as.character(MONTH),levels=as.character(1:12),labels=c("Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"))] %>%
	ggplot() +
	xlab("Lunar illumination") + ylab("Encounter probability (%)") +
	scale_x_continuous(breaks=c(0,0.25,0.5,0.75,1)) +
    geom_line(aes(x = LUNAR_PHASE_BIN, y=value, color = variable)) +
    geom_point(aes(x = LUNAR_PHASE_BIN, y=value, fill = variable,size=N),shape=21,color="black") +
    geom_hline(yintercept = 0) +
    theme_classic(base_size = 10) +
    facet_grid(variable~MONTH, scales = "free") +
    scale_fill_nmfs(name="Species",palette="regional web") +
    scale_color_nmfs(name="Species",palette="regional web") +
    labs(title = "Encounter probability by species, degree of lunar illumination, and month.",
         caption = "The percent of research fishing sets that encountered each species. \n Circle size represents the number of fishing sets. \n Note: Catch is recorded seperately by bait type within the same sample.")
```

```{r warning=FALSE}
	cols = c("VESSEL",deep8_code_vec)
	research_fishing_dt %>%
	.[,cols,with=FALSE] %>%
	melt(.,id.vars=c("VESSEL")) %>%
	.[,value:=ifelse(value>0,1,0)] %>%
	.[,.(value=mean(value),.N),by=.(VESSEL,variable)] %>%
	.[,value:=value*100] %>%
	.[,variable:=factor(variable,levels=deep8_code_vec,labels=deep8_name_vec)] %>%
	.[,VESSEL:=as.numeric(as.factor(VESSEL))] %>%
	ggplot() +
	xlab("Vessel ID") + ylab("Encounter probability (%)") +
	scale_x_continuous(breaks=c(1,5,10,15)) +
    geom_segment(aes(x = VESSEL,xend=VESSEL,y=0, yend=value, color = variable)) +
    geom_point(aes(x = VESSEL, y=value, fill = variable,size=N),shape=21,color="black") +
    geom_hline(yintercept = 0) +
    theme_classic(base_size = 10) +
    facet_wrap(~variable, scales = "free_y") +
    scale_fill_nmfs(name="Species",palette="regional web") +
    scale_color_nmfs(name="Species",palette="regional web") +
    labs(title = "Encounter probability by species and Vessel ID.",
         caption = "The percent of research fishing sets that encountered each species. \n Circle size represents the number of fishing sets. \n Note: Catch is recorded seperately by bait type within the same sample.")
```


```{r warning=FALSE}
	cols = c("Island","VESSEL",deep8_code_vec)
	research_fishing_dt %>%
	.[,cols,with=FALSE] %>%
	melt(.,id.vars=c("Island","VESSEL")) %>%
	.[,value:=ifelse(value>0,1,0)] %>%
	.[,.(value=mean(value),.N),by=.(Island,VESSEL,variable)] %>%
	.[,value:=value*100] %>%
	.[,variable:=factor(variable,levels=deep8_code_vec,labels=deep8_name_vec)] %>%
	.[,VESSEL:=as.numeric(as.factor(VESSEL))] %>%
	.[,Island:=factor(Island,levels=c("Niihau","Kauai","Oahu","Maui Nui","Big Island"),labels=c("Niihau","Kauai","Oahu","Maui Nui","Hawaii"))] %>%
	ggplot() +
	xlab("Vessel ID") + ylab("Encounter probability (%)") +
	scale_x_continuous(breaks=c(1,5,10,15)) +
    geom_segment(aes(x = VESSEL,xend=VESSEL,y=0, yend=value, color = variable)) +
    geom_point(aes(x = VESSEL, y=value, fill = variable,size=N),shape=21,color="black") +
    geom_hline(yintercept = 0) +
    theme_classic(base_size = 10) +
    facet_grid(variable~Island, scales = "free_y") +
    scale_fill_nmfs(name="Species",palette="regional web") +
    scale_color_nmfs(name="Species",palette="regional web") +
    labs(title = "Encounter probability by species, island group, and Vessel ID.",
         caption = "The percent of research fishing sets that encountered each species. \n Circle size represents the number of fishing sets. \n Note: Catch is recorded seperately by bait type within the same sample.")
```


```{r warning=FALSE}
	cols = c("CAPTAIN_CD",deep8_code_vec)
	research_fishing_dt %>%
	.[,cols,with=FALSE] %>%
	melt(.,id.vars=c("CAPTAIN_CD")) %>%
	.[,value:=ifelse(value>0,1,0)] %>%
	.[,.(value=mean(value),.N),by=.(CAPTAIN_CD,variable)] %>%
	.[,value:=value*100] %>%
	.[,variable:=factor(variable,levels=deep8_code_vec,labels=deep8_name_vec)] %>%
	.[,CAPTAIN_CD:=as.numeric(as.factor(CAPTAIN_CD))] %>%
	ggplot() +
	xlab("Captain ID") + ylab("Encounter probability (%)") +
	scale_x_continuous(breaks=c(1,5,10)) +
    geom_segment(aes(x = CAPTAIN_CD,xend=CAPTAIN_CD,y=0, yend=value, color = variable)) +
    geom_point(aes(x = CAPTAIN_CD, y=value, fill = variable,size=N),shape=21,color="black") +
    geom_hline(yintercept = 0) +
    theme_classic(base_size = 10) +
    facet_wrap(~variable, scales = "free_y") +
    scale_fill_nmfs(name="Species",palette="regional web") +
    scale_color_nmfs(name="Species",palette="regional web") +
    labs(title = "Encounter probability by species and Captain ID.",
         caption = "The percent of research fishing sets that encountered each species. \n Circle size represents the number of fishing sets. \n Note: Catch is recorded seperately by bait type within the same sample.")
```


```{r warning=FALSE}
	cols = c("Island","CAPTAIN_CD",deep8_code_vec)
	research_fishing_dt %>%
	.[,cols,with=FALSE] %>%
	melt(.,id.vars=c("Island","CAPTAIN_CD")) %>%
	.[,value:=ifelse(value>0,1,0)] %>%
	.[,.(value=mean(value),.N),by=.(Island,CAPTAIN_CD,variable)] %>%
	.[,value:=value*100] %>%
	.[,variable:=factor(variable,levels=deep8_code_vec,labels=deep8_name_vec)] %>%
	.[,CAPTAIN_CD:=as.numeric(as.factor(CAPTAIN_CD))] %>%
	.[,Island:=factor(Island,levels=c("Niihau","Kauai","Oahu","Maui Nui","Big Island"),labels=c("Niihau","Kauai","Oahu","Maui Nui","Hawaii"))] %>%
	ggplot() +
	xlab("Captain ID") + ylab("Encounter probability (%)") +
	scale_x_continuous(breaks=c(1,5,10,15)) +
    geom_segment(aes(x = CAPTAIN_CD,xend=CAPTAIN_CD,y=0, yend=value, color = variable)) +
    geom_point(aes(x = CAPTAIN_CD, y=value, fill = variable,size=N),shape=21,color="black") +
    geom_hline(yintercept = 0) +
    theme_classic(base_size = 10) +
    facet_grid(variable~Island, scales = "free_y") +
    scale_fill_nmfs(name="Species",palette="regional web") +
    scale_color_nmfs(name="Species",palette="regional web") +
    labs(title = "Encounter probability by species, island group, and Captain ID.",
         caption = "The percent of research fishing sets that encountered each species. \n Circle size represents the number of fishing sets. \n Note: Catch is recorded seperately by bait type within the same sample.")
```
```{r warning=FALSE}
	cols = c("TIME_MIN",deep8_code_vec)
	research_fishing_dt %>%
	.[,cols,with=FALSE] %>%
	.[,TIME_MIN:=floor(TIME_MIN)] %>%
	melt(.,id.vars=c("TIME_MIN")) %>%
	.[,value:=ifelse(value>0,1,0)] %>%
	.[,.(value=mean(value),.N),by=.(TIME_MIN,variable)] %>%
	.[,value:=value*100] %>%
	.[,variable:=factor(variable,levels=deep8_code_vec,labels=deep8_name_vec)] %>%
	.[,TIME_MIN:=factor(as.character(TIME_MIN),levels=as.character(0:24))] %>%
	ggplot() +
	xlab("Time of day") + ylab("Encounter probability (%)") +
	scale_x_discrete(breaks=c("6","12","18"),drop=FALSE) +
    geom_segment(aes(x = TIME_MIN,xend=TIME_MIN,y=0, yend=value, color = variable)) +
    geom_point(aes(x = TIME_MIN, y=value, fill = variable,size=N),shape=21,color="black") +
    geom_hline(yintercept = 0) +
    theme_classic(base_size = 10) +
    facet_wrap(~variable, scales = "free_y") +
    scale_fill_nmfs(name="Species",palette="regional web") +
    scale_color_nmfs(name="Species",palette="regional web") +
    labs(title = "Encounter probability by species and time of day.",
         caption = "The percent of research fishing sets that encountered each species. \n Circle size represents the number of fishing sets. \n Note: Catch is recorded seperately by bait type within the same sample.")
```
```{r warning=FALSE}
	cols = c("TIME_MIN","Island",deep8_code_vec)
	research_fishing_dt %>%
	.[,cols,with=FALSE] %>%
	.[,TIME_MIN:=floor(TIME_MIN)] %>%
	melt(.,id.vars=c("Island","TIME_MIN")) %>%
	.[,value:=ifelse(value>0,1,0)] %>%
	.[,.(value=mean(value),.N),by=.(Island,TIME_MIN,variable)] %>%
	.[,value:=value*100] %>%
	.[,variable:=factor(variable,levels=deep8_code_vec,labels=deep8_name_vec)] %>%
	.[,TIME_MIN:=factor(as.character(TIME_MIN),levels=as.character(0:24))] %>%
	.[,Island:=factor(Island,levels=c("Niihau","Kauai","Oahu","Maui Nui","Big Island"),labels=c("Niihau","Kauai","Oahu","Maui Nui","Hawaii"))] %>%
	ggplot() +
	xlab("Time of day") + ylab("Encounter probability (%)") +
	scale_x_discrete(breaks=c("6","12","18"),drop=FALSE) +
    geom_segment(aes(x = TIME_MIN,xend=TIME_MIN,y=0, yend=value, color = variable)) +
    geom_point(aes(x = TIME_MIN, y=value, fill = variable,size=N),shape=21,color="black") +
    geom_hline(yintercept = 0) +
    theme_classic(base_size = 10) +
    facet_grid(variable~Island, scales = "free_y") +
    scale_fill_nmfs(name="Species",palette="regional web") +
    scale_color_nmfs(name="Species",palette="regional web") +
    labs(title = "Encounter probability by species, time of day, and island group.",
         caption = "The percent of research fishing sets that encountered each species. \n Circle size represents the number of fishing sets. \n Note: Catch is recorded seperately by bait type within the same sample.")
```
```{r warning=FALSE}
	cols = c("DEPTH_M",deep8_code_vec)
	research_fishing_dt %>%
	.[,cols,with=FALSE] %>%
	.[,DEPTH_M:=floor(DEPTH_M/50)*50] %>%
	melt(.,id.vars=c("DEPTH_M")) %>%
	.[,value:=ifelse(value>0,1,0)] %>%
	.[,.(value=mean(value),.N),by=.(DEPTH_M,variable)] %>%
	.[,value:=value*100] %>%
	.[,variable:=factor(variable,levels=deep8_code_vec,labels=deep8_name_vec)] %>%
	.[,DEPTH_M:=factor(as.character(DEPTH_M),levels=as.character(seq(from=0,to=450,by=50)))] %>%
	ggplot() +
	xlab("Depth (m)") + ylab("Encounter probability (%)") +
	scale_x_discrete(breaks=c("100","200","300"),drop=FALSE) +
    geom_segment(aes(x = DEPTH_M,xend=DEPTH_M,y=0, yend=value, color = variable)) +
    geom_point(aes(x = DEPTH_M, y=value, fill = variable,size=N),shape=21,color="black") +
    geom_hline(yintercept = 0) +
    theme_classic(base_size = 10) +
    facet_wrap(~variable, scales = "free_y") +
    scale_fill_nmfs(name="Species",palette="regional web") +
    scale_color_nmfs(name="Species",palette="regional web") +
    labs(title = "Encounter probability by species and depth.",
         caption = "The percent of research fishing sets that encountered each species. \n Circle size represents the number of fishing sets. \n Note: Catch is recorded seperately by bait type within the same sample.")
```

```{r warning=FALSE}
	cols = c("DEPTH_M","Island",deep8_code_vec)
	research_fishing_dt %>%
	.[,cols,with=FALSE] %>%
	.[,DEPTH_M:=(floor(DEPTH_M/50)*50)/100] %>%
	melt(.,id.vars=c("Island","DEPTH_M")) %>%
	.[,value:=ifelse(value>0,1,0)] %>%
	.[,.(value=mean(value),.N),by=.(Island,DEPTH_M,variable)] %>%
	.[,value:=value*100] %>%
	.[,variable:=factor(variable,levels=deep8_code_vec,labels=deep8_name_vec)] %>%
	.[,DEPTH_M:=factor(as.character(DEPTH_M),levels=as.character(seq(from=0,to=4.50,by=0.50)))] %>%
	.[,Island:=factor(Island,levels=c("Niihau","Kauai","Oahu","Maui Nui","Big Island"),labels=c("Niihau","Kauai","Oahu","Maui Nui","Hawaii"))] %>%
	ggplot() +
	xlab("Depth (100 m)") + ylab("Encounter probability (%)") +
	scale_x_discrete(breaks=c("1","2","3"),drop=FALSE) +
    geom_segment(aes(x = DEPTH_M,xend=DEPTH_M,y=0, yend=value, color = variable)) +
    geom_point(aes(x = DEPTH_M, y=value, fill = variable,size=N),shape=21,color="black") +
    geom_hline(yintercept = 0) +
    theme_classic(base_size = 10) +
    facet_grid(variable~Island, scales = "free_y") +
    scale_fill_nmfs(name="Species",palette="regional web") +
    scale_color_nmfs(name="Species",palette="regional web") +
    labs(title = "Encounter probability by species, depth, and island group.",
         caption = "The percent of research fishing sets that encountered each species. \n Circle size represents the number of fishing sets. \n Note: Catch is recorded seperately by bait type within the same sample.")
```
```{r warning=FALSE}
	cols = c("LON",deep8_code_vec)
	research_fishing_dt %>%
	.[,cols,with=FALSE] %>%
	.[,LON:=floor(LON/0.25)*0.25] %>%
	melt(.,id.vars=c("LON")) %>%
	.[,value:=ifelse(value>0,1,0)] %>%
	.[,.(value=mean(value),.N),by=.(LON,variable)] %>%
	.[,value:=value*100] %>%
	.[,variable:=factor(variable,levels=deep8_code_vec,labels=deep8_name_vec)] %>%
	.[,LON:=factor(as.character(LON),levels=as.character(seq(from=-160.5,to=-154,by=0.250)))] %>%
	ggplot() +
	xlab("Longitude") + ylab("Encounter probability (%)") +
	scale_x_discrete(breaks=c("-158","-156","-154"),drop=FALSE) +
    geom_segment(aes(x = LON,xend=LON,y=0, yend=value, color = variable)) +
    geom_point(aes(x = LON, y=value, fill = variable,size=N),shape=21,color="black") +
    geom_hline(yintercept = 0) +
    theme_classic(base_size = 10) +
    facet_wrap(~variable, scales = "free_y") +
    scale_fill_nmfs(name="Species",palette="regional web") +
    scale_color_nmfs(name="Species",palette="regional web") +
    labs(title = "Encounter probability by species and longitude.",
         caption = "The percent of research fishing sets that encountered each species. \n Circle size represents the number of fishing sets. \n Note: Catch is recorded seperately by bait type within the same sample.")
```
```{r warning=FALSE}
	cols = c("Island","LON",deep8_code_vec)
	research_fishing_dt %>%
	.[,cols,with=FALSE] %>%
	.[,LON:=floor(LON/0.25)*0.25] %>%
	melt(.,id.vars=c("Island","LON")) %>%
	.[,value:=ifelse(value>0,1,0)] %>%
	.[,.(value=mean(value),.N),by=.(Island,LON,variable)] %>%
	.[,value:=value*100] %>%
	.[,variable:=factor(variable,levels=deep8_code_vec,labels=deep8_name_vec)] %>%
	.[,Island:=factor(Island,levels=c("Niihau","Kauai","Oahu","Maui Nui","Big Island"),labels=c("Niihau","Kauai","Oahu","Maui Nui","Hawaii"))] %>%
	.[,LON:=factor(as.character(LON),levels=as.character(seq(from=-160.5,to=-154,by=0.250)))] %>%
	ggplot() +
	xlab("Longitude") + ylab("Encounter probability (%)") +
	scale_x_discrete(breaks=c("-158","-156","-154"),drop=FALSE) +
    geom_segment(aes(x = LON,xend=LON,y=0, yend=value, color = variable)) +
    geom_point(aes(x = LON, y=value, fill = variable,size=N),shape=21,color="black") +
    geom_hline(yintercept = 0) +
    theme_classic(base_size = 10) +
    facet_grid(variable~Island, scales = "free_y") +
    scale_fill_nmfs(name="Species",palette="regional web") +
    scale_color_nmfs(name="Species",palette="regional web") +
    labs(title = "Encounter probability by species, longitude, and island group.",
         caption = "The percent of research fishing sets that encountered each species. \n Circle size represents the number of fishing sets. \n Note: Catch is recorded seperately by bait type within the same sample.")
```
```{r warning=FALSE}
	cols = c("LAT",deep8_code_vec)
	research_fishing_dt %>%
	.[,cols,with=FALSE] %>%
	.[,LAT:=floor(LAT/0.25)*0.25] %>%
	melt(.,id.vars=c("LAT")) %>%
	.[,value:=ifelse(value>0,1,0)] %>%
	.[,.(value=mean(value),.N),by=.(LAT,variable)] %>%
	.[,value:=value*100] %>%
	.[,variable:=factor(variable,levels=deep8_code_vec,labels=deep8_name_vec)] %>%
	.[,LAT:=factor(as.character(LAT),levels=as.character(seq(from=18.5,to=22.5,by=0.250)))] %>%
	ggplot() +
	xlab("Latitude") + ylab("Encounter probability (%)") +
	scale_x_discrete(breaks=c("19","20","21"),drop=FALSE) +
    geom_segment(aes(x = LAT,xend=LAT,y=0, yend=value, color = variable)) +
    geom_point(aes(x = LAT, y=value, fill = variable,size=N),shape=21,color="black") +
    geom_hline(yintercept = 0) +
    theme_classic(base_size = 10) +
    facet_wrap(~variable, scales = "free_y") +
    scale_fill_nmfs(name="Species",palette="regional web") +
    scale_color_nmfs(name="Species",palette="regional web") +
    labs(title = "Encounter probability by species and latitude.",
         caption = "The percent of research fishing sets that encountered each species. \n Circle size represents the number of fishing sets. \n Note: Catch is recorded seperately by bait type within the same sample.")
```

```{r warning=FALSE}
	cols = c("Island","LAT",deep8_code_vec)
	research_fishing_dt %>%
	.[,cols,with=FALSE] %>%
	.[,LAT:=floor(LAT/0.25)*0.25] %>%
	melt(.,id.vars=c("Island","LAT")) %>%
	.[,value:=ifelse(value>0,1,0)] %>%
	.[,.(value=mean(value),.N),by=.(Island,LAT,variable)] %>%
	.[,value:=value*100] %>%
	.[,variable:=factor(variable,levels=deep8_code_vec,labels=deep8_name_vec)] %>%
	.[,Island:=factor(Island,levels=c("Niihau","Kauai","Oahu","Maui Nui","Big Island"),labels=c("Niihau","Kauai","Oahu","Maui Nui","Hawaii"))] %>%
	.[,LAT:=factor(as.character(LAT),levels=as.character(seq(from=18.5,to=22.5,by=0.250)))] %>%
	ggplot() +
	xlab("Latitude") + ylab("Encounter probability (%)") +
	scale_x_discrete(breaks=c("19","20","21"),drop=FALSE) +
    geom_segment(aes(x = LAT,xend=LAT,y=0, yend=value, color = variable)) +
    geom_point(aes(x = LAT, y=value, fill = variable,size=N),shape=21,color="black") +
    geom_hline(yintercept = 0) +
    theme_classic(base_size = 10) +
    facet_grid(variable~Island, scales = "free_y") +
    scale_fill_nmfs(name="Species",palette="regional web") +
    scale_color_nmfs(name="Species",palette="regional web") +
    labs(title = "Encounter probability by species, latitude, and island group.",
         caption = "The percent of research fishing sets that encountered each species. \n Circle size represents the number of fishing sets. \n Note: Catch is recorded seperately by bait type within the same sample.")
```

```{r warning=FALSE}
	cols = c("STRATA",deep8_code_vec)
	research_fishing_dt %>%
	.[,cols,with=FALSE] %>%
	melt(.,id.vars=c("STRATA")) %>%
	.[,value:=ifelse(value>0,1,0)] %>%
	.[,.(value=mean(value),.N),by=.(STRATA,variable)] %>%
	.[,value:=value*100] %>%
	.[,variable:=factor(variable,levels=deep8_code_vec,labels=deep8_name_vec)] %>%
	ggplot() +
	xlab("Survey strata") + ylab("Encounter probability (%)") +
    geom_segment(aes(x = STRATA,xend=STRATA,y=0, yend=value, color = variable)) +
    geom_point(aes(x = STRATA, y=value, fill = variable,size=N),shape=21,color="black") +
    geom_hline(yintercept = 0) +
    theme_classic(base_size = 10) +
    theme(axis.text.x = element_text(angle = 90, vjust = 1, hjust=1)) +
    facet_wrap(~variable, scales = "free_y") +
    scale_fill_nmfs(name="Species",palette="regional web") +
    scale_color_nmfs(name="Species",palette="regional web") +
    labs(title = "Encounter probability by species and survey strata.",
         caption = "The percent of research fishing sets that encountered each species. \n Circle size represents the number of fishing sets. \n Note: Catch is recorded seperately by bait type within the same sample.")
```
```{r warning=FALSE}
	cols = c("Island","STRATA",deep8_code_vec)
	research_fishing_dt %>%
	.[,cols,with=FALSE] %>%
	melt(.,id.vars=c("Island","STRATA")) %>%
	.[,value:=ifelse(value>0,1,0)] %>%
	.[,.(value=mean(value),.N),by=.(Island,STRATA,variable)] %>%
	.[,value:=value*100] %>%
	.[,variable:=factor(variable,levels=deep8_code_vec,labels=deep8_name_vec)] %>%
	.[,Island:=factor(Island,levels=c("Niihau","Kauai","Oahu","Maui Nui","Big Island"),labels=c("Niihau","Kauai","Oahu","Maui Nui","Hawaii"))] %>%
	ggplot() +
	xlab("Survey strata") + ylab("Encounter probability (%)") +
    geom_segment(aes(x = STRATA,xend=STRATA,y=0, yend=value, color = variable)) +
    geom_point(aes(x = STRATA, y=value, fill = variable,size=N),shape=21,color="black") +
    geom_hline(yintercept = 0) +
    theme_classic(base_size = 10) +
    theme(axis.text.x = element_text(angle = 90, vjust = 1, hjust=1)) +
    facet_grid(variable~Island, scales = "free_y") +
    scale_fill_nmfs(name="Species",palette="regional web") +
    scale_color_nmfs(name="Species",palette="regional web") +
    labs(title = "Encounter probability by species, survey strata, and island group.",
         caption = "The percent of research fishing sets that encountered each species. \n Circle size represents the number of fishing sets. \n Note: Catch is recorded seperately by bait type within the same sample.")
```

## Positive catch

## Nominal CPUE